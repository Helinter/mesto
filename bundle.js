(()=>{"use strict";class e{constructor(e,t,n,s,i,o){this.id=e._id,this.myId=i,this.api=o,this._cardElement=t.querySelector(".element").cloneNode(!0),this._name=e.name,this._link=e.link,this._likes=e.likes,this._ownerId=e.ownerId,this._titleImage=this._cardElement.querySelector(".element__image"),this._deleteButton=this._cardElement.querySelector(".element__delete-button"),this._likeButton=this._cardElement.querySelector(".element__like-button"),this._likeCounter=this._cardElement.querySelector(".element__like-counter"),this._listItem=this._deleteButton.closest(".element"),this._handleCardClick=n,this._handleDeleteClick=s,this._imageData={link:this._link,name:this._name}}createCard(){return this._htmlSettings(),this._setEventListeners(),this._ownerId!==this.myId&&this._deleteButton.remove(),this._cardElement}_updateDeleteButton(){this._ownerId===this.myId?this._cardElement.appendChild(this._deleteButton):this._deleteButton.remove()}_htmlSettings(){this._cardElement.querySelector(".element__title").textContent=this._name,this._titleImage.setAttribute("src",this._link),this._titleImage.setAttribute("alt",this._name),this._likeCounter.textContent=this._likes.length}_setEventListeners(){this._likeButton.addEventListener("click",(()=>this._toggleLike())),this._deleteButton.addEventListener("click",(()=>this._deleteOn())),this._titleImage.addEventListener("click",(()=>this._popupImgOn()))}_popupImgOn(){this._handleCardClick(this._imageData)}_deleteOn(){this._handleDeleteClick(this)}deleteCard(){this.api.deleteCard(this.id).then((()=>{this._listItem.remove(),this._listItem=null,console.log("карточка удалена")})).catch((e=>{console.error("Ошибка при удалении карточки:",e)}))}_toggleLike(){this._likeButton.classList.toggle("element__like-button_active"),this._likeButton.classList.contains("element__like-button_active")?this._likes.push({}):this._likes.pop(),this._likeCounter.textContent=this._likes.length}}class t{constructor(e,t){this._submitButton=document.getElementById("cardSubmit"),this._config=e,this._formElement=t,this._inputsList=this._formElement.querySelectorAll(this._config.inputSelector),this._submitButtonElement=this._formElement.querySelector(this._config.submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector))}enableValidation(){this._setEventListeners()}_setEventListeners(){[...this._inputsList].forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}_toggleButtonState(){this._formElement.checkValidity()?(this._submitButtonElement.disabled=!1,this._submitButtonElement.classList.remove(this._config.inactiveButtonClass)):(this._submitButtonElement.disabled=!0,this._submitButtonElement.classList.add(this._config.inactiveButtonClass))}_checkInputValidity(e){this._errorElement=this._formElement.querySelector(`#${e.name}-error`);const t=e.validity.valid;this._errorElement&&(t?this._hideError(e):this._showError(e))}_showError(e){e.classList.add(this._config.inputErrorClass),this._errorElement.textContent=e.validationMessage}_hideError(e){e.classList.remove(this._config.inputErrorClass),this._errorElement.textContent=e.validationMessage}_buttonDisabled(){this._submitButton.classList.add(this._config.inactiveButtonClass),this._submitButton.disabled=!0}}const n={formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__container-button",inactiveButtonClass:"popup__container-button_invalid",inputErrorClass:"popup__input_invalid",errorClass:"error"};class s{constructor({items:e,renderer:t},n){this._renderer=t,this._container=document.querySelector(n),this._items=e.reverse()}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e,t=!1){t?this._container.prepend(e):this._container.append(e)}}class i{constructor(e){this._popupSelector=e,this._popupElement=document.querySelector(e),this._closePopup=this._popupElement.querySelector(".popup__container-close-button"),this._popupContainer=this._popupElement.querySelector(".popup__container"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(){this._popupElement.addEventListener("click",(e=>{e.target===this._popupElement&&this.close()}))}setEventListeners(){this._closePopup.addEventListener("click",this.close.bind(this)),this._handleOverlayClose()}}class o extends i{constructor(e){super(e),this._popupImg=this._popupElement.querySelector(".popup__img"),this._popupTitle=this._popupElement.querySelector(".popup__image-container-title")}open(e){super.open(),this._popupTitle.textContent=e.name,this._popupImg.src=e.link,this._popupImg.alt=e.name}}class r extends i{constructor(e,t){super(e),this.formElement=this._popupElement.querySelector(".form"),this.handleFormSubmit=t,this._formSubmitButton=this._popupElement.querySelector(".popup__container-button"),this._inputElements=this.formElement.querySelectorAll("input")}close(){super.close(),this.formElement.reset()}_getInputValues(){const e={};return this._inputElements.forEach((t=>{const n=t.name,s=t.value;e[n]=s})),e}setEventListeners(){super.setEventListeners(),this.formElement.addEventListener("submit",(e=>{e.preventDefault(),this.handleFormSubmit(this._getInputValues())}))}}class l{constructor({nameSelector:e,infoSelector:t}){this._nameElement=document.querySelector(e),this._infoElement=document.querySelector(t)}getUserInfo(){return{name:this._nameElement.textContent,info:this._infoElement.textContent}}setUserInfo({name:e,info:t}){this._nameElement.textContent=e,this._infoElement.textContent=t}}const a=new class{constructor(e){this.url=e.url,this.headers=e.headers}async getCards(){const e=await fetch(`${this.url}/cards`,{headers:this.headers});return e.ok?e.json():await Promise.reject(`Ошибка: ${e.status}`)}async addCard(e,t){const n=await fetch(`${this.url}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})});return n.ok?n.json():await Promise.reject(`Ошибка: ${n.status}`)}async updateProfile(e,t){const n=await fetch(`${this.url}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})});return n.ok?n.json():await Promise.reject(`Ошибка: ${n.status}`)}async getUserInfo(){const e=await fetch(`${this.url}/users/me`,{headers:this.headers});return e.ok?e.json():await Promise.reject(`Ошибка: ${e.status}`)}async deleteCard(e){const t=await fetch(`${this.url}/cards/${e}`,{method:"DELETE",headers:this.headers});return t.ok?t.json():await Promise.reject(`Ошибка: ${t.status}`)}}({url:"https://mesto.nomoreparties.co/v1/cohort-70",headers:{authorization:"9e4f7ba1-e97e-4ac3-9791-bede623fb8bb","Content-Type":"application/json"}}),c=document.querySelector(".card").content,u=document.querySelector(".popup__input_type_name"),_=document.querySelector(".popup__input_type_job"),h=document.querySelector(".profile__info-title"),d=document.querySelector(".profile__info-subtitle"),m=document.querySelector(".profile__avatar"),p=document.querySelector(".profile__info-edit-button"),E=document.forms.profileForm,f=document.querySelector(".profile__add-button"),y=document.forms.placeForm;let g;a.getUserInfo().then((e=>{const t=e;return h.textContent=t.name,d.textContent=t.about,m.src=t.avatar,g=t._id,g})).then((i=>{console.log(i);const h=new r(".popup_type_edit-profile",(e=>{const t=e.formName,n=e.formJob;a.updateProfile(t,n),k.setUserInfo({name:t,info:n}),h.close()}));function d(e){const s=new t(n,e);s.enableValidation(),e.addEventListener("submit",(()=>{s._buttonDisabled()}))}h.setEventListeners(),p.addEventListener("click",(function(){const e=k.getUserInfo().name,t=k.getUserInfo().info;u.value=e,_.value=t,h.open()})),f.addEventListener("click",(function(){m.open()}));const m=new r(".popup_type_card",(e=>{const t={name:e.formPlace,link:e.formLink,likes:[]};a.addCard(t.name,t.link).then((e=>{console.log(t),console.log("newCard._id",e._id),t._id=e._id,t.ownerId=i,function(e,t){const n=I(e,t);b.addItem(n,!0)}(t,i),m.close(),console.log(t)})).catch((e=>{console.error("Ошибка при добавлении карточки:",e)}))}));m.setEventListeners();const g=new o(".popup_type_image");g.setEventListeners();const k=new l({nameSelector:".profile__info-title",infoSelector:".profile__info-subtitle"});let b;function v(e){g.open(e)}d(E),d(y),a.getCards().then((e=>{const t=e.map((e=>({name:e.name,link:e.link,likes:e.likes,ownerId:e.owner._id,_id:e._id})));b=new s({items:t,renderer:w},".elements"),b.renderItems()}));const C=new r(".popup_type_delete",(function(){S.deleteCard(),C.close()}));let S;function L(e){C.open(),S=e}function I(t,n){return new e(t,c,v,L,n,a).createCard()}function w(e){b.addItem(I(e,i),!0)}C.setEventListeners()}))})();